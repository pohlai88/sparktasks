/**
 * MAPS v2.2 Design System - CSS Foundation Layer
 *
 * INTEGRATION ARCHITECTURE:
 * 1. Tailwind Config → CSS Custom Properties (this layer)
 * 2. Enhanced Tokens → Tailwind classes
 * 3. Components → Enhanced tokens semantic API
 *
 * COMPLIANCE:
 * - Dark-First Foundation: All colors optimized for dark mode
 * - Apple HIG Harmony: Semantic hierarchy with sophisticated accents
 * - AAA Accessibility: 7:1+ contrast ratios enforced
 * - Liquid Glass Materials: Governed vibrancy system
 */

@import 'tailwindcss/base';
@import 'tailwindcss/components';
@import 'tailwindcss/utilities';

/* ===== DARK-FIRST FOUNDATION LAYER ===== */

@layer base {
  /**
   * CSS Custom Properties - Dark-First Foundation
   * These map directly to our Tailwind config and provide the foundation
   * for both enhanced tokens and component implementations
   */
  :root {
    /* Deep Space Canvas System - Primary surfaces */
    --background: 10 15 22; /* #0a0f16 - Deep space canvas */
    --background-elevated: 23 22 42; /* #17162a - Perfect depth (ΔL=0.045) */
    --background-panel: 36 28 65; /* #241c41 - Ideal panel surface */
    --background-overlay: 0 0 0; /* #000000 - Overlay base */

    /* Apple HIG Content Hierarchy - Guaranteed AAA compliance */
    --foreground: 232 236 241; /* #e8ecf1 - Calm off-white (16.8:1) */
    --foreground-muted: 200 206 214; /* #c8ced6 - Secondary (9.2:1) */
    --foreground-subtle: 156 163 175; /* #9ca3af - Tertiary (5.1:1) */
    --foreground-disabled: 120 128 140; /* #78808c - Disabled (3.8:1) */
    --muted-foreground: 166 187 222; /* #a6bbde - Muted with ethereal hint */

    /* Apple-Calm Accent System - Sophisticated, not harsh */
    --primary: 48 176 199; /* #30b0c7 - Apple-calm teal */
    --primary-hover: 58 186 222; /* #3abade - Gentle lift */
    --primary-foreground: 255 255 255; /* #ffffff - Maximum contrast */

    /* Secondary Apple Harmony */
    --secondary: 88 86 214; /* #5856d6 - Apple system purple */
    --secondary-hover: 98 96 224; /* #6260e0 - Refined interaction */
    --secondary-foreground: 255 255 255; /* #ffffff - High contrast */

    /* Enhanced Accent System - Missing variables for components */
    --accent: 48 176 199; /* #30b0c7 - Primary accent (same as primary) */
    --accent-foreground: 255 255 255; /* #ffffff - High contrast on accent */
    --accent-foreground-muted: 200 206 214; /* #c8ced6 - Muted accent text */
    --accent-hover: 58 186 222; /* #3abade - Accent hover state */
    --accent-pressed: 38 138 159; /* #268a9f - Accent pressed state */
    --accent-secondary: 88 86 214; /* #5856d6 - Secondary accent */
    --accent-secondary-foreground: 255 255 255; /* #ffffff - Secondary accent text */
    --accent-secondary-hover: 98 96 224; /* #6260e0 - Secondary accent hover */

    /* Semantic Feedback - Apple HIG naturals */
    --success: 52 199 89; /* #34c759 - Apple system green */
    --success-foreground: 255 255 255; /* #ffffff */
    --warning: 255 149 0; /* #ff9500 - Apple system orange */
    --warning-foreground: 255 255 255; /* #ffffff */
    --error: 255 59 48; /* #ff3b30 - Apple system red */
    --error-foreground: 255 255 255; /* #ffffff */

    /* Destructive Actions (maps to error for consistency) */
    --destructive: 255 59 48; /* #ff3b30 - Apple system red */
    --destructive-foreground: 255 255 255; /* #ffffff */

    /* AAA-Only Solid Fills for Compliance Mode */
    --accent-solid-aaa: 38 138 159; /* #268a9f - 7:1+ contrast */
    --success-solid-aaa: 42 159 71; /* #2a9f47 - 7:1+ contrast */
    --error-solid-aaa: 204 47 38; /* #cc2f26 - 7:1+ compliance */

    /* Border & Stroke System */
    --border: 91 103 118; /* #5b6776 - Hairline dividers (2.8:1) */
    --border-strong: 128 148 166; /* #8094a6 - Strong elements (4.1:1) */
    --border-accent: 48 176 199; /* #30b0c7 - Accent borders */

    /* Interactive States */
    --ring: 48 176 199; /* #30b0c7 - Focus rings */
    --muted: 36 28 65; /* #241c41 - Muted backgrounds */

    /* Motion System Variables */
    --motion-duration-instant: 75ms;
    --motion-duration-fast: 120ms;
    --motion-duration-normal: 180ms;
    --motion-duration-slow: 240ms;
    --motion-easing-linear: linear;
    --motion-easing-standard: cubic-bezier(0.2, 0, 0.2, 1);
    --motion-easing-emphasized: cubic-bezier(0.2, 0.8, 0.2, 1);

    /* Elevation & Glass Materials */
    --card: var(--background-elevated);
    --popover: var(--background-panel);
    --input: var(--background-elevated);

    /* Z-Index Management */
    --z-surface: 0;
    --z-overlay: 10;
    --z-modal: 20;
    --z-popover: 30;
    --z-toast: 40;
    --z-tooltip: 50;
  }

  /**
   * Light Mode Override (when needed)
   * Maintains the same semantic structure with light adaptations
   */
  .light {
    --background: 255 255 255;
    --background-elevated: 250 250 250;
    --background-panel: 245 245 245;
    --background-overlay: 255 255 255;

    --foreground: 10 15 22;
    --foreground-muted: 102 102 102;
    --foreground-subtle: 128 128 128;
    --foreground-disabled: 163 163 163;
    --muted-foreground: 115 115 115;

    /* Accent colors remain consistent for brand recognition */
    --primary: 48 176 199;
    --primary-hover: 38 138 159;
    --primary-foreground: 255 255 255;

    /* Enhanced Accent System - Light mode variants */
    --accent: 48 176 199; /* #30b0c7 - Primary accent */
    --accent-foreground: 255 255 255; /* #ffffff - High contrast on accent */
    --accent-foreground-muted: 102 102 102; /* Muted accent text for light mode */
    --accent-hover: 38 138 159; /* #268a9f - Accent hover (darker in light) */
    --accent-pressed: 28 108 129; /* #1c6c81 - Accent pressed (even darker) */
    --accent-secondary: 88 86 214; /* #5856d6 - Secondary accent */
    --accent-secondary-foreground: 255 255 255; /* #ffffff - Secondary accent text */
    --accent-secondary-hover: 78 76 204; /* #4e4ccc - Secondary hover (darker) */

    /* Semantic Feedback - Light mode */
    --success: 52 199 89; /* #34c759 - Apple system green */
    --success-foreground: 255 255 255; /* #ffffff */
    --warning: 255 149 0; /* #ff9500 - Apple system orange */
    --warning-foreground: 255 255 255; /* #ffffff */
    --error: 255 59 48; /* #ff3b30 - Apple system red */
    --error-foreground: 255 255 255; /* #ffffff */
    --destructive: 255 59 48; /* #ff3b30 - Apple system red */
    --destructive-foreground: 255 255 255; /* #ffffff */

    --border: 229 229 229;
    --border-strong: 204 204 204;
    --ring: 48 176 199;
    --muted: 245 245 245;

    --card: 255 255 255;
    --popover: 255 255 255;
    --input: 255 255 255;
  }

  /**
   * High Contrast Mode - Maximum accessibility
   * Forces maximum contrast for users with visual impairments
   */
  .high-contrast {
    --background: 0 0 0;
    --background-elevated: 0 0 0;
    --background-panel: 0 0 0;
    --foreground: 255 255 255;
    --foreground-muted: 255 255 255;
    --primary: 0 255 255;
    --primary-foreground: 0 0 0;
    --border: 255 255 255;
    --border-strong: 255 255 255;
  }
}

/* ===== APPLE-GRADE TYPOGRAPHY FOUNDATION ===== */

@layer base {
  /**
   * Apple Typography Semantic Hierarchy
   * Based on SF Pro Text metrics adapted for web
   */
  html {
    /* Apple-grade text rendering */
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    text-rendering: optimizeLegibility;
    font-feature-settings:
      'kern' 1,
      'liga' 1,
      'calt' 1;
  }

  body {
    /* MAPS v2.2 Base Styles - CSS custom properties only */
    background-color: rgb(var(--background));
    color: rgb(var(--foreground));
    font-family:
      -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue',
      Arial, sans-serif;
    font-size: 1rem;
    line-height: 1.5;
    letter-spacing: -0.003em;
    transition:
      background-color 0.2s ease,
      color 0.2s ease;
  }

  /* Semantic HTML Elements with Apple HIG typography */
  h1 {
    color: rgb(var(--foreground));
    font-size: 2.25rem;
    font-weight: 700;
    line-height: 1.2;
    letter-spacing: -0.025em;
  }
  h2 {
    color: rgb(var(--foreground));
    font-size: 1.875rem;
    font-weight: 600;
    line-height: 1.3;
    letter-spacing: -0.025em;
  }
  h3 {
    color: rgb(var(--foreground));
    font-size: 1.5rem;
    font-weight: 600;
    line-height: 1.3;
  }
  h4 {
    color: rgb(var(--foreground));
    font-size: 1.25rem;
    font-weight: 600;
    line-height: 1.4;
  }
  h5 {
    color: rgb(var(--foreground));
    font-size: 1.125rem;
    font-weight: 500;
    line-height: 1.4;
  }
  h6 {
    color: rgb(var(--foreground));
    font-size: 1rem;
    font-weight: 500;
    line-height: 1.4;
  }

  p {
    color: rgb(var(--foreground));
    font-size: 1rem;
    line-height: 1.625;
  }
  small {
    color: rgb(var(--foreground-muted));
    font-size: 0.875rem;
  }
  strong,
  b {
    color: rgb(var(--foreground));
    font-weight: 600;
  }
  em,
  i {
    color: rgb(var(--foreground));
    font-style: italic;
  }

  /* Apple-style link treatment */
  a {
    color: rgb(var(--primary));
    font-weight: 500;
    text-decoration: underline;
    text-decoration-thickness: 1px;
    text-underline-offset: 2px;
    transition: color 0.2s ease;
  }

  a:hover {
    color: rgb(var(--primary-hover));
  }

  a:focus-visible {
    outline: 2px solid rgb(var(--ring));
    outline-offset: 2px;
  }

  /* Code and technical content */
  code {
    background-color: rgb(var(--muted));
    border-radius: 0.25rem;
    padding: 0.125rem 0.375rem;
    font-family:
      'SF Mono', Monaco, Inconsolata, 'Roboto Mono', 'Consolas', monospace;
    font-size: 0.875rem;
  }

  pre {
    overflow-x: auto;
    border-radius: 0.5rem;
    background-color: rgb(var(--background-panel));
    padding: 1rem;
    font-family:
      'SF Mono', Monaco, Inconsolata, 'Roboto Mono', 'Consolas', monospace;
    font-size: 0.875rem;
  }

  /* Form elements with Apple-grade styling */
  input,
  textarea,
  select {
    background-color: rgb(var(--input));
    border-radius: 0.375rem;
    border: 1px solid rgb(var(--border));
    padding: 0.5rem 0.75rem;
    color: rgb(var(--foreground));
    transition: all 200ms;
  }

  input::placeholder,
  textarea::placeholder,
  select::placeholder {
    color: rgb(var(--foreground-subtle));
  }

  input:focus-visible,
  textarea:focus-visible,
  select:focus-visible {
    outline: none;
    border-color: rgb(var(--border-accent));
    box-shadow: 0 0 0 2px rgb(var(--ring));
  }
}

/* ===== LIQUID GLASS MATERIALS SYSTEM ===== */

@layer components {
  /**
   * Liquid Glass Utilities - Apple Materials for Web
   * CRITICAL: Only applies to surfaces, never to content
   */
  .glass-standard {
    backdrop-filter: blur(12px) saturate(135%);
    background-color: rgb(var(--background-panel) / 0.8);
    border: 1px solid rgb(var(--border) / 0.3);
  }

  .glass-elevated {
    backdrop-filter: blur(8px) saturate(135%);
    background-color: rgb(var(--background-elevated) / 0.85);
    border: 1px solid rgb(var(--border) / 0.2);
  }

  .glass-floating {
    backdrop-filter: blur(16px) saturate(135%);
    background-color: rgb(var(--background-panel) / 0.75);
    border: 1px solid rgb(var(--border) / 0.4);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
  }

  /* AAA Text Scrim for accessibility over glass */
  .text-scrim {
    background-color: rgb(var(--background) / 0.85);
    color: rgb(var(--foreground));
    padding: 0.25rem;
    border-radius: 0.125rem;
  }

  /* Content protection gradient */
  .content-scrim {
    background: linear-gradient(
      to bottom,
      rgb(var(--background) / 0.9),
      rgb(var(--background) / 0.95)
    );
  }
}

/* ===== ACCESSIBILITY & MOTION SYSTEM ===== */

@layer utilities {
  /**
   * Apple-Grade Motion System
   * Respects user motion preferences
   */
  .motion-safe-standard {
    transition: all 180ms cubic-bezier(0.2, 0, 0.2, 1);
  }

  .motion-safe-emphasized {
    transition: all 240ms cubic-bezier(0.2, 0.8, 0.2, 1);
  }

  .motion-safe-decelerate {
    transition: all 200ms cubic-bezier(0, 0, 0.2, 1);
  }

  /**
   * Focus Management - Apple accessibility standards
   */
  .focus-apple:focus-visible {
    outline: none;
    box-shadow:
      0 0 0 2px rgb(var(--background)),
      0 0 0 4px rgb(var(--ring));
  }

  /**
   * Platform-Aware Hit Targets
   */
  .hit-target-base {
    min-height: 44px;
    min-width: 44px;
  }

  .hit-target-large {
    min-height: 48px;
    min-width: 48px;
  }

  .hit-target-compact {
    min-height: 36px;
    min-width: 36px;
  }

  @media (hover: hover) and (pointer: fine) {
    .hit-target-base {
      min-height: 32px;
      min-width: 32px;
    }
  }

  /**
   * Screen Reader Utilities
   */
  .sr-only-focusable {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }

  .sr-only-focusable:focus {
    position: absolute;
    left: 0;
    top: 0;
    width: auto;
    height: auto;
    padding: inherit;
    margin: inherit;
    overflow: visible;
    clip: auto;
    white-space: normal;
  }
}

/* ===== ENTERPRISE ACCESSIBILITY ENHANCEMENTS ===== */

/**
 * Windows High Contrast Mode Support
 * Critical for enterprise accessibility compliance
 */
@media (forced-colors: active) {
  [data-radix-dialog-overlay] {
    forced-color-adjust: none;
    background: Canvas;
  }

  [data-radix-dialog-content] {
    forced-color-adjust: none;
    background: CanvasText;
    color: Canvas;
    border: 1px solid Canvas;
  }
}

/**
 * Reduced Transparency Preference Support
 * Respects system accessibility preferences
 */
@media (prefers-reduced-transparency: reduce) {
  .backdrop-blur-sm,
  .backdrop-blur-md,
  .backdrop-blur-lg,
  .backdrop-blur-xl {
    backdrop-filter: none;
    -webkit-backdrop-filter: none;
  }

  [data-radix-dialog-content] {
    background: rgb(var(--background-elevated)) !important;
  }
}

/**
 * Motion Reduction Compliance
 * Essential for vestibular disorder accessibility
 */
@media (prefers-reduced-motion: reduce) {
  [data-radix-dialog-overlay] {
    animation: none !important;
    transition: opacity 0.15s ease !important;
  }

  [data-radix-dialog-content] {
    animation: none !important;
    transition: opacity 0.15s ease !important;
    transform: translate(-50%, -50%) !important;
  }
}

/* ===== PRINT STYLES ===== */

@media print {
  /**
   * Print-optimized styles
   * High contrast, remove backgrounds, optimize typography
   */
  * {
    color: #000 !important;
    background: transparent !important;
    box-shadow: none !important;
    text-shadow: none !important;
  }

  body {
    font-size: 12pt;
    line-height: 1.4;
  }

  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    page-break-after: avoid;
    font-weight: bold;
  }

  p,
  blockquote {
    orphans: 3;
    widows: 3;
  }

  blockquote,
  pre {
    page-break-inside: avoid;
  }

  a {
    text-decoration: underline;
  }

  a[href^='http']:after {
    content: ' (' attr(href) ')';
    font-size: 0.8em;
  }
}

/* ===== REDUCED MOTION COMPLIANCE ===== */

@media (prefers-reduced-motion: reduce) {
  /**
   * Respect user motion preferences
   * Disable all animations and transitions
   */
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
}

/* ===== HIGH CONTRAST MODE SUPPORT ===== */

@media (prefers-contrast: high) {
  /**
   * Enhanced contrast for better accessibility
   */
  :root {
    --border: 255 255 255;
    --border-strong: 255 255 255;
    --foreground: 255 255 255;
    --background: 0 0 0;
  }
}

/* ===== ENHANCED INPUT ACCESSIBILITY SHIMS ===== */

/* Forced Colors (Windows High Contrast) Support */
@media (forced-colors: active) {
  input,
  [role='textbox'] {
    forced-color-adjust: none;
    background: Field;
    color: FieldText;
    border: 1px solid FieldText;
  }

  input:focus-visible {
    outline: 2px solid Highlight;
    outline-offset: 2px;
  }
}

/* Autofill AAA Compliance - iOS/Chrome */
:root {
  --autofill-bg: 20 25 35;
  --autofill-fg: 248 250 252;
  --autofill-ring: 30 81 192;
  --autofill-offset: 13 17 23;
}

input:-webkit-autofill,
input:-webkit-autofill:focus {
  -webkit-text-fill-color: rgb(var(--autofill-fg));
  box-shadow: 0 0 0px 1000px rgb(var(--autofill-bg)) inset !important;
  border: 1px solid rgb(var(--autofill-bg)) !important;
  transition: background-color 9999s ease-in-out 0s; /* Prevent autofill flash */
}
