<!doctype html>
<html lang="en" class="dark">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>MAPS v2.2 — Liquid Glass Material System</title>
    <link rel="stylesheet" href="./src/index.css" />
    <style>
      /* Demo-specific styles */
      body {
        background:
          radial-gradient(
            900px 700px at 70% -10%,
            rgba(124, 196, 255, 0.15),
            transparent
          ),
          linear-gradient(
            180deg,
            rgb(var(--background)),
            rgb(var(--background-elevated)) 40%,
            rgb(var(--background-panel))
          );
        min-height: 100vh;
        font-family: var(--font);
        color: rgb(var(--foreground));
        padding: 24px;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

      .hero {
        text-align: center;
        padding: 80px 40px;
        margin-bottom: 60px;
      }

      .hero h1 {
        font-size: 56px;
        font-weight: 700;
        margin: 0 0 24px;
        background: linear-gradient(
          135deg,
          rgb(var(--accent)),
          rgb(var(--accent-secondary))
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .hero-subtitle {
        font-size: 20px;
        color: rgb(var(--foreground-muted));
        margin-bottom: 40px;
      }

      .demo-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 32px;
        margin: 60px 0;
      }

      .demo-card {
        min-height: 400px;
        padding: 32px;
        border-radius: 20px;
        position: relative;
        display: flex;
        flex-direction: column;
        gap: 24px;
      }

      .card-title {
        font-size: 24px;
        font-weight: 600;
        margin: 0;
      }

      .card-content {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 16px;
      }

      .glass-button {
        padding: 12px 24px;
        border-radius: 12px;
        border: none;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
        background: rgba(var(--accent) / 0.8);
        color: rgb(var(--accent-foreground));
      }

      .glass-button:hover {
        background: rgba(var(--accent-hover) / 0.9);
        transform: translateY(-1px);
      }

      .feature-list {
        list-style: none;
        padding: 0;
        margin: 0;
      }

      .feature-list li {
        padding: 8px 0;
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .feature-list li::before {
        content: '✓';
        color: rgb(var(--success));
        font-weight: bold;
      }

      .controls {
        position: fixed;
        top: 24px;
        right: 24px;
        display: flex;
        gap: 12px;
        z-index: 100;
      }

      .control-btn {
        padding: 8px 16px;
        border-radius: 999px;
        border: 1px solid rgba(var(--border));
        background: rgba(var(--background-elevated) / 0.9);
        backdrop-filter: blur(12px);
        color: rgb(var(--foreground));
        cursor: pointer;
        font-size: 14px;
        transition: all 0.2s ease;
      }

      .control-btn:hover {
        background: rgba(var(--accent) / 0.8);
        color: rgb(var(--accent-foreground));
      }

      .control-btn.active {
        background: rgb(var(--accent));
        color: rgb(var(--accent-foreground));
      }

      .accessibility-demo {
        margin: 60px 0;
        padding: 40px;
        border-radius: 20px;
        text-align: center;
      }

      .contrast-info {
        margin-top: 16px;
        padding: 12px 20px;
        border-radius: 8px;
        font-family: ui-monospace, monospace;
        font-size: 14px;
        background: rgba(var(--background) / 0.8);
      }

      /* Background patterns for glass testing */
      .pattern-dots {
        background-image: radial-gradient(
          circle,
          rgba(var(--accent) / 0.3) 1px,
          transparent 1px
        );
        background-size: 20px 20px;
      }

      .pattern-lines {
        background-image:
          linear-gradient(
            45deg,
            rgba(var(--accent-secondary) / 0.2) 25%,
            transparent 25%
          ),
          linear-gradient(
            -45deg,
            rgba(var(--accent-secondary) / 0.2) 25%,
            transparent 25%
          );
        background-size: 30px 30px;
      }

      .pattern-gradient {
        background: linear-gradient(
          135deg,
          rgba(var(--accent) / 0.2),
          rgba(var(--accent-secondary) / 0.2),
          rgba(var(--success) / 0.2)
        );
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Controls -->
      <div class="controls">
        <button class="control-btn active" id="transparencyToggle">
          🪟 Glass On
        </button>
        <button class="control-btn" id="aaaToggle">♿ AAA Mode</button>
        <button class="control-btn" id="themeToggle">🌙 Dark</button>
      </div>

      <!-- Hero Section -->
      <div class="hero">
        <h1>Liquid Glass</h1>
        <p class="hero-subtitle">
          Apple HIG materials for the web, with governed accessibility and
          ethereal sophistication
        </p>
      </div>

      <!-- Main Demo Grid -->
      <div class="demo-grid">
        <!-- Basic Glass Card -->
        <div class="demo-card glass pattern-dots">
          <h3 class="card-title">
            <span class="scrim">Basic Glass Material</span>
          </h3>
          <div class="card-content">
            <p class="scrim">
              Standard glass pane with ethereal tint and backdrop blur. Text
              uses the scrim pattern for guaranteed AAA compliance.
            </p>
            <ul class="feature-list">
              <li class="scrim">Backdrop filter: 12px blur</li>
              <li class="scrim">Color saturation: 1.35x</li>
              <li class="scrim">Ethereal accent tint</li>
              <li class="scrim">Edge-lit stroke system</li>
            </ul>
            <button class="glass-button scrim">Interactive Element</button>
          </div>
        </div>

        <!-- Small Glass Variant -->
        <div class="demo-card glass glass-sm pattern-lines">
          <h3 class="card-title">
            <span class="scrim">Subtle Glass (6px)</span>
          </h3>
          <div class="card-content">
            <p class="scrim">
              Reduced blur for subtle depth separation while maintaining the
              material aesthetic. Perfect for nested elements.
            </p>
            <div class="contrast-info scrim" id="contrast-small">
              Contrast: Calculating...
            </div>
          </div>
        </div>

        <!-- Large Glass Variant -->
        <div class="demo-card glass glass-lg pattern-gradient">
          <h3 class="card-title">
            <span class="scrim">Deep Glass (18px)</span>
          </h3>
          <div class="card-content">
            <p class="scrim">
              Enhanced blur for strong focus separation. Use sparingly for modal
              overlays and primary surfaces.
            </p>
            <div class="contrast-info scrim" id="contrast-large">
              Contrast: Calculating...
            </div>
          </div>
        </div>

        <!-- Without Glass (Fallback) -->
        <div
          class="demo-card"
          style="
            background: rgba(var(--background-elevated) / 0.95);
            border: 1px solid rgba(var(--border));
          "
        >
          <h3 class="card-title">Fallback Surface</h3>
          <div class="card-content">
            <p>
              Solid surface fallback for users who prefer reduced transparency
              or when backdrop-filter isn't supported.
            </p>
            <div class="contrast-info" id="contrast-fallback">
              Contrast: Calculating...
            </div>
          </div>
        </div>
      </div>

      <!-- Accessibility Demo -->
      <div class="accessibility-demo glass">
        <h2 class="scrim">Accessibility Integration</h2>
        <p class="scrim">
          The liquid glass system includes automatic AAA compliance through
          scrim patterns, transparency reduction toggles, and contrast
          validation.
        </p>

        <div
          style="
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 32px;
          "
        >
          <div style="text-align: center">
            <div
              class="scrim"
              style="
                font-size: 32px;
                font-weight: bold;
                color: rgb(var(--success));
              "
              id="harmony-score"
            >
              7.2:1
            </div>
            <div
              class="scrim"
              style="font-size: 14px; color: rgb(var(--foreground-muted))"
            >
              Harmony Mode
            </div>
          </div>

          <div style="text-align: center">
            <div
              class="scrim"
              style="
                font-size: 32px;
                font-weight: bold;
                color: rgb(var(--success));
              "
              id="aaa-score"
            >
              8.1:1
            </div>
            <div
              class="scrim"
              style="font-size: 14px; color: rgb(var(--foreground-muted))"
            >
              AAA Enhanced
            </div>
          </div>

          <div style="text-align: center">
            <div
              class="scrim"
              style="
                font-size: 32px;
                font-weight: bold;
                color: rgb(var(--accent));
              "
              id="fallback-score"
            >
              16.2:1
            </div>
            <div
              class="scrim"
              style="font-size: 14px; color: rgb(var(--foreground-muted))"
            >
              No Transparency
            </div>
          </div>
        </div>
      </div>

      <!-- Usage Guidelines -->
      <div
        style="
          margin: 60px 0;
          padding: 40px;
          background: rgba(var(--background-elevated) / 0.95);
          border-radius: 20px;
          border: 1px solid rgba(var(--border));
        "
      >
        <h2>Usage Guidelines</h2>

        <div
          style="
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 32px;
            margin-top: 32px;
          "
        >
          <div>
            <h3 style="color: rgb(var(--success))">✅ Do</h3>
            <ul>
              <li>Use <code>.scrim</code> for text on glass</li>
              <li>Apply glass to containers, not content</li>
              <li>Respect performance budgets (avoid nested blur)</li>
              <li>Test with transparency toggle</li>
            </ul>
          </div>

          <div>
            <h3 style="color: rgb(var(--error))">❌ Don't</h3>
            <ul>
              <li>Stack multiple backdrop filters</li>
              <li>Use glass without scrim for text</li>
              <li>Apply to performance-critical animations</li>
              <li>Ignore reduced transparency preferences</li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Contrast calculation utilities
      const relLum = ([r, g, b]) => {
        const srgb = [r, g, b]
          .map(v => v / 255)
          .map(v =>
            v <= 0.03928 ? v / 12.92 : Math.pow((v + 0.055) / 1.055, 2.4)
          );
        return 0.2126 * srgb[0] + 0.7152 * srgb[1] + 0.0722 * srgb[2];
      };

      const ratio = (fg, bg) => {
        const L1 = relLum(fg),
          L2 = relLum(bg);
        const [a, b] = L1 > L2 ? [L1, L2] : [L2, L1];
        return (a + 0.05) / (b + 0.05);
      };

      const cssRGB = name => {
        const value = getComputedStyle(document.documentElement)
          .getPropertyValue('--' + name)
          .trim();
        return value.split(' ').map(Number);
      };

      // Control functionality
      const transparencyToggle = document.getElementById('transparencyToggle');
      const aaaToggle = document.getElementById('aaaToggle');
      const themeToggle = document.getElementById('themeToggle');

      let transparencyEnabled = true;
      let aaaMode = false;
      let darkMode = true;

      transparencyToggle.addEventListener('click', () => {
        transparencyEnabled = !transparencyEnabled;
        document.documentElement.classList.toggle(
          'no-transparency',
          !transparencyEnabled
        );
        transparencyToggle.textContent = transparencyEnabled
          ? '🪟 Glass On'
          : '🚫 Glass Off';
        transparencyToggle.classList.toggle('active', transparencyEnabled);
        updateContrasts();
      });

      aaaToggle.addEventListener('click', () => {
        aaaMode = !aaaMode;
        document.documentElement.classList.toggle('aaa', aaaMode);
        aaaToggle.textContent = aaaMode ? '♿ AAA On' : '♿ AAA Off';
        aaaToggle.classList.toggle('active', aaaMode);
        updateContrasts();
      });

      themeToggle.addEventListener('click', () => {
        darkMode = !darkMode;
        document.documentElement.classList.toggle('dark', darkMode);
        themeToggle.textContent = darkMode ? '🌙 Dark' : '☀️ Light';
        updateContrasts();
      });

      function updateContrasts() {
        try {
          const fg = cssRGB('foreground');
          const bg = cssRGB('background');
          const scrimBg = cssRGB('background'); // Simplified for demo

          const harmonyRatio = ratio(fg, scrimBg);
          const aaaRatio = harmonyRatio * (aaaMode ? 1.12 : 1); // Simulated enhancement
          const fallbackRatio = ratio(fg, cssRGB('background-elevated'));

          document.getElementById('harmony-score').textContent =
            `${harmonyRatio.toFixed(1)}:1`;
          document.getElementById('aaa-score').textContent =
            `${aaaRatio.toFixed(1)}:1`;
          document.getElementById('fallback-score').textContent =
            `${fallbackRatio.toFixed(1)}:1`;

          // Update individual contrast info
          const contrastSmall = document.getElementById('contrast-small');
          const contrastLarge = document.getElementById('contrast-large');
          const contrastFallback = document.getElementById('contrast-fallback');

          if (contrastSmall)
            contrastSmall.textContent = `Scrim Contrast: ${harmonyRatio.toFixed(2)}:1`;
          if (contrastLarge)
            contrastLarge.textContent = `Scrim Contrast: ${harmonyRatio.toFixed(2)}:1`;
          if (contrastFallback)
            contrastFallback.textContent = `Text Contrast: ${fallbackRatio.toFixed(2)}:1`;
        } catch (error) {
          console.warn('Contrast calculation failed:', error);
        }
      }

      // Initialize
      document.addEventListener('DOMContentLoaded', () => {
        updateContrasts();

        // Demo the accessibility toggle after a few seconds
        setTimeout(() => {
          if (
            confirm(
              'Would you like to see the accessibility transparency toggle in action?'
            )
          ) {
            transparencyToggle.click();
            setTimeout(() => {
              alert(
                'Notice how the glass materials become solid surfaces while maintaining the same visual hierarchy and contrast ratios. This respects user preferences for reduced transparency.'
              );
            }, 1000);
          }
        }, 5000);
      });

      // Performance monitoring
      if ('requestIdleCallback' in window) {
        requestIdleCallback(() => {
          const glassElements = document.querySelectorAll(
            '.glass, .glass-sm, .glass-lg'
          );
          console.log(
            `🪟 Glass Material Performance: ${glassElements.length} elements using backdrop-filter`
          );

          // Warn about potential performance issues
          if (glassElements.length > 10) {
            console.warn(
              '⚠️ Consider reducing glass elements for better performance'
            );
          }
        });
      }
    </script>
  </body>
</html>
